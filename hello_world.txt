#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <conio.h>
#include <Windows.h>

#define KEY_LEFT (256 + 75)
#define KEY_RIGHT (256 + 77)

int GetKey(void);
double GetElapsedTime(clock_t initial_clock, clock_t current_clock);
void GotoXY(int x, int y);
void Erase(int x, int y); // (x, y)로 이동하여 공백 문자 출력
void Draw(int x, int y); // (x, y)로 이동하여 ‘*’ 문자 출력

int main(void)
{
	srand(time(NULL));

	int x = rand() % 80;
	int y = 0;
	Draw(x, y);

	clock_t initial_clock = clock(); // 1/1000초 단위로 1씩 증가

	while (1)
	{
		Sleep(1);
		clock_t current_clock = clock();

		if (GetElapsedTime(initial_clock, current_clock) > 0.1)
		{   // 0.5초 경과
			Erase(x, y);
			//y++;
			//if (y == 25)
			//	y = 0;
			y = (y + 1) % 25;
			Draw(x, y);

			//if (y == 24)
				//break;

			initial_clock = current_clock; // 기준 시각 재설정
		}
		if (_kbhit())
		{
			int key = GetKey();

			if (key == KEY_LEFT)
			{
				Erase(x, y);
				x--;
				Draw(x, y);
			}
			else if (key == KEY_RIGHT)
			{
				Erase(x, y);
				x++;
				Draw(x, y);
			}
		}
	}
}
int GetKey(void)
{
	int ch = _getch();

	if (ch == 0 || ch == 224)
		// 방향키의 경우 0 또는 224의 값이 먼저 입력됨
		ch = 256 + _getch();
	// 그 다음에 해당 방향키에 따라 72(Up),
	// 80(Down), 75(Left), 77(Right) 값이 입력됨
	return ch;
}

double GetElapsedTime(clock_t initial_clock, clock_t current_clock)
{
	return (double)(current_clock - initial_clock) / CLOCKS_PER_SEC;
}

void GotoXY(int x, int y)
{
	// COORD 구조체 변수를 통해 이동할 위치 설정
	COORD pos = { x, y };
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), pos);
}

void Erase(int x, int y)
{
	GotoXY(x, y);
	printf(" ");
}

void Draw(int x, int y)
{
	GotoXY(x, y);
	printf("*");
}